{% extends "base.html" %}
{% block content %}
<h2>Register</h2>
{% if error %}
<div style="color: red;">{{ error }}</div>
{% endif %}

<form method="post" action="/register">
    <!-- ROLE -->
    <div class="form-row">
        <label>Role</label>
        <select id="roleSelect" name="role" onchange="onRoleChange()" required>
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
        </select>
    </div>

    <!-- USERNAME -->
    <div class="form-row">
        <label>Username</label>
        <input type="text" name="username" required />
    </div>

    <!-- PASSWORD -->
    <div class="form-row">
        <label>Password</label>
        <input type="password" name="password" required />
        <small class="password-help">
            Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter,
            and one digit.
        </small>
    </div>

    <!-- FIRST NAME -->
    <div class="form-row">
        <label>First Name</label>
        <input type="text" name="name" required />
    </div>

    <!-- LAST NAME -->
    <div class="form-row">
        <label>Last Name</label>
        <input type="text" name="surname" required />
    </div>

    <!-- STUDENT SINGLE-SELECT (Hidden if Teacher) -->
    <div class="form-row" id="studentClassRow">
        <label>Class (Single)</label>
        <select name="class_name" id="studentClassSelect" required>
            <option value="7-A">7-A</option>
            <option value="7-B">7-B</option>
            <option value="7-C">7-C</option>
            <option value="7-D">7-D</option>
        </select>
    </div>

    <!-- TEACHER MULTI-SELECT (Hidden if Student) -->
    <div class="form-row" id="teacherClassRow" style="display:none;">
        <label>Class (Multiple)</label>
        <!-- 
            We will show a clickable "container" that, when clicked, 
            reveals checkboxes for each class. Then we rely on name="class_name" 
            to pass them as multiple form values.
        -->
        <div class="multi-class-dropdown" onclick="toggleMultiClassDropdown(event)">
            <div class="multi-class-header" id="multiClassHeader">
                <span id="multiClassPlaceholder">Select classes...</span>
                <i class="arrow-down"></i>
            </div>
            <div class="multi-class-list" id="multiClassList" style="display: none;">
                <label>
                    <input type="checkbox" name="class_name" value="7-A" /> 7-A
                </label>
                <label>
                    <input type="checkbox" name="class_name" value="7-B" /> 7-B
                </label>
                <label>
                    <input type="checkbox" name="class_name" value="7-C" /> 7-C
                </label>
                <label>
                    <input type="checkbox" name="class_name" value="7-D" /> 7-D
                </label>
            </div>
        </div>
    </div>

    <!-- REGISTERED SECTION (for teacher) -->
    <div class="form-row" id="sectionRow" style="display:none;">
        <label>Registered Section</label>
        <select name="registered_section" id="sectionSelect" required>
            <option value="">-- Select Section --</option>
            <option value="math">Math</option>
            <option value="english">English</option>
            <option value="physics">Physics</option>
            <option value="chemistry">Chemistry</option>
        </select>
    </div>

    <button type="submit">Register</button>
</form>

<script>
    function onRoleChange() {
        const roleVal = document.getElementById('roleSelect').value;
        const studentClassRow = document.getElementById('studentClassRow');
        const teacherClassRow = document.getElementById('teacherClassRow');
        const sectionRow = document.getElementById('sectionRow');

        if (roleVal === 'teacher') {
            // Teacher: Hide single-select, show multi-select + section
            studentClassRow.style.display = 'none';
            teacherClassRow.style.display = 'block';
            sectionRow.style.display = 'block';
        } else {
            // Student: Hide multi-select, show single-select, hide section
            studentClassRow.style.display = 'block';
            teacherClassRow.style.display = 'none';
            sectionRow.style.display = 'none';
        }
    }

    // Toggle the multi-class dropdown
    function toggleMultiClassDropdown(event) {
        // If the user clicked a checkbox, don't immediately close the list
        const multiClassList = document.getElementById('multiClassList');
        const isCheckbox = event.target.type === 'checkbox';
        if (!isCheckbox) {
            // Toggle display
            multiClassList.style.display =
                multiClassList.style.display === 'none' ? 'block' : 'none';
        }
        // Prevent event from bubbling up to form or label
        event.stopPropagation();
    }

    // Close the dropdown if clicked outside
    document.addEventListener('click', function (e) {
        const multiClassList = document.getElementById('multiClassList');
        const teacherClassRow = document.getElementById('teacherClassRow');
        if (!teacherClassRow.contains(e.target)) {
            // click happened outside the multiClass area
            multiClassList.style.display = 'none';
        }
    });

    onRoleChange(); // Initialize the form on page load
</script>
{% endblock %}