{% extends "base.html" %}
{% block content %}
<h2>Exam Screen</h2>
<div id="timer">Time Left: <span id="timeLeft"></span> seconds</div>

<form id="examForm" method="post" action="/student_submit_exam">
    <input type="hidden" name="exam_id" value="{{ exam_id }}">

    {% for section_number, question_list in sections.items() %}
    <h3>Section {{ section_number }}</h3>

    {% for q in question_list %}
    <div class="question-box">
        <p class="question-text"><strong>{{ q.question }}</strong> (Points: {{ q.points }})</p>

        {% if q.type == 'true_false' %}
        <!-- True/False: typically 2 radio buttons -->
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="True"> True
        </label>
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="False"> False
        </label>

        {% elif q.type == 'single_choice' %}
        <!-- Single Choice: radio buttons -->
        {% if q.choices %}
        {% for choice in q.choices %}
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="{{ choice.choice_text }}"> {{
            choice.choice_text }}
        </label>
        {% endfor %}
        {% else %}
        <!-- Default A-D if no choices -->
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="A"> A
        </label>
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="B"> B
        </label>
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="C"> C
        </label>
        <label class="option">
            <input type="radio" name="answer_{{ q.question_id }}" value="D"> D
        </label>
        {% endif %}

        {% elif q.type == 'multiple_choice' %}
        <!-- Multiple Choice: checkboxes -->
        {% if q.choices %}
        {% for choice in q.choices %}
        <label class="option">
            <input type="checkbox" name="answer_{{ q.question_id }}" value="{{ choice.choice_text }}"> {{
            choice.choice_text }}
        </label>
        {% endfor %}
        {% else %}
        <!-- Default 4 options -->
        <label class="option">
            <input type="checkbox" name="answer_{{ q.question_id }}" value="A"> A
        </label>
        <label class="option">
            <input type="checkbox" name="answer_{{ q.question_id }}" value="B"> B
        </label>
        <label class="option">
            <input type="checkbox" name="answer_{{ q.question_id }}" value="C"> C
        </label>
        <label class="option">
            <input type="checkbox" name="answer_{{ q.question_id }}" value="D"> D
        </label>
        {% endif %}

        {% elif q.type == 'ordering' %}
        {% if q.choices %}
        <p>Please enter the correct order of these items (comma-separated):</p>
        <ul>
            {% for c in q.choices %}
            <li>{{ c.choice_text }}</li>
            {% endfor %}
        </ul>
        <input type="text" name="answer_{{ q.question_id }}" placeholder="e.g. 3,1,4,2">
        {% else %}
        <p>No choices available for ordering question.</p>
        <input type="text" name="answer_{{ q.question_id }}" placeholder="Enter your ordering...">
        {% endif %}

        {% else %}
        <!-- Unknown type -->
        <label>Your Answer:</label>
        <input type="text" name="answer_{{ q.question_id }}">
        {% endif %}
    </div>
    {% endfor %}
    {% endfor %}

    <button type="submit">Submit Exam</button>
</form>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Example countdown - 300 seconds
    let totalTime = 300;
    startCountdown(totalTime, () => {
        document.getElementById("examForm").submit();
    });
</script>
{% endblock %}