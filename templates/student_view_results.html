<!-- templates/student_view_results.html -->
{% extends "base.html" %}
{% block content %}
<h2>My Exam Results</h2>

{% if results_data.exams | length == 0 %}
<p>No exam records found.</p>
{% else %}
<p>School No: {{ results_data.student_number }}</p>
<p>Class: {{ results_data.class_name }}</p>
<p>Total Attempts: {{ results_data.attempts }}</p>

{% for exam in results_data.exams %}
<div style="border:1px solid #999; padding:10px; margin-bottom:15px;">
    <h3>Exam #{{ loop.index }}</h3>
    <p>Start Time: {{ exam.start_time }}<br>
        End Time: {{ exam.end_time if exam.end_time else "In Progress" }}</p>

    <!-- Section-based summary -->
    <table class="table">
        <thead>
            <tr>
                <th>Section</th>
                <th>Correct Answers</th>
                <th>Wrong Answers</th>
                <th>Class Avg.</th>
                <th>School Avg.</th>
                <th>Score</th>
                <th>Overall Avg.</th>
            </tr>
        </thead>
        <tbody>
            {% for sec in exam.sections_details %}
            <tr>
                <td>{{ sec.section_number }}</td>
                <td>{{ sec.correct_answers }}</td>
                <td>{{ sec.wrong_answers }}</td>
                <td>{{ sec.so }}</td>
                <td>{{ sec.oo }}</td>
                <td>{{ sec.notu }}</td>
                <td>{{ sec.ort }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if exam.pass_fail == "ge√ßemedi" %}
    <p style="color:red;">
        Result: Failed (You must score at least 75 in each section).
    </p>
    {% else %}
    <p style="color:lime;">
        Result: Passed, congratulations!
    </p>
    {% endif %}

    <!-- Detailed question info -->
    <h4>Question Details</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Question</th>
                <th>Your Answer(s)</th>
                <th>Correct Answer(s)</th>
                <th>Status</th>
                <th>Points</th>
            </tr>
        </thead>
        <tbody>
            {% for qd in exam.questions_details %}
            <tr>
                <td>{{ qd.question_text }}</td>
                <td>
                    {% if qd.student_answers and qd.student_answers|length > 0 %}
                    {% if qd.status == "Wrong" %}
                    {% for ans in qd.student_answers %}
                    <span style="color:red;">{{ ans }}</span><br>
                    {% endfor %}
                    {% elif qd.status == "Partially Correct" %}
                    {% for ans in qd.student_answers %}
                    {% if ans in qd.correct_answers %}
                    <span style="color:lime;">{{ ans }}</span><br>
                    {% else %}
                    <span style="color:red;">{{ ans }}</span><br>
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    <!-- qd.status == "Correct" -->
                    {% for ans in qd.student_answers %}
                    <span style="color:lime;">{{ ans }}</span><br>
                    {% endfor %}
                    {% endif %}
                    {% else %}
                    <span style="color:red;">(No answer)</span>
                    {% endif %}
                </td>
                <td>
                    {% for correct in qd.correct_answers %}
                    <span style="color:lime;">{{ correct }}</span><br>
                    {% endfor %}
                </td>
                <td>
                    {% if qd.status == "Correct" %}
                    <span style="color:lime;">Correct</span>
                    {% elif qd.status == "Partially Correct" %}
                    <span style="color:orange;">Partially Correct</span>
                    {% else %}
                    <span style="color:red;">Wrong</span>
                    {% endif %}
                </td>
                <td>{{ qd.points_earned }}/{{ qd.points_possible }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endfor %}
{% endif %}
{% endblock %}